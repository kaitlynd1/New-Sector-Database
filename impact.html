<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NSA Alumni Impact</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafa;
      color: #14455C;
      padding-top: 80px;
    }

    .navbar {
      background-color: #14455C;
      padding: 15px 40px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .navbar-brand {
      color: white;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    .nav-link {
      color: white !important;
      margin-left: 30px;
    }

    .nav-link.active {
      border-bottom: 2px solid #3CBAC8;
    }

    .tab-content {
      padding: 30px;
    }

    canvas {
      max-width: 800px;
      max-height: 600px;
      margin: auto;
      background: white;
      border: 2px solid #D4DFE6;
      border-radius: 10px;
      display: block;
    }
  </style>
</head>

<body>

<nav class="navbar fixed-top navbar-expand-lg">
  <a class="navbar-brand" href="#">New Sector Alliance</a>
  <div class="collapse navbar-collapse">
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="index.html">Alumni Directory</a></li>
      <li class="nav-item"><a class="nav-link active" href="impact.html">Impact Dashboard</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <ul class="nav nav-tabs" id="chartTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="field-tab" data-bs-toggle="tab" data-bs-target="#field" type="button" role="tab">By Issue Area</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="org-tab" data-bs-toggle="tab" data-bs-target="#org" type="button" role="tab">Top Host Orgs</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="gender-tab" data-bs-toggle="tab" data-bs-target="#gender" type="button" role="tab">Gender</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="race-tab" data-bs-toggle="tab" data-bs-target="#race" type="button" role="tab">Race/Ethnicity</button>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="field" role="tabpanel">
      <canvas id="fieldChart"></canvas>
    </div>
    <div class="tab-pane fade" id="org" role="tabpanel">
      <canvas id="orgChart"></canvas>
    </div>
    <div class="tab-pane fade" id="gender" role="tabpanel">
      <canvas id="genderChart"></canvas>
    </div>
    <div class="tab-pane fade" id="race" role="tabpanel">
      <canvas id="raceChart"></canvas>
    </div>
  </div>
</div>

<script>
  const fieldMapping = {
    "Education": ["Education", "Education & Economic Development"],
    "Youth Development": ["Youth Development", "Education & Youth Development"],
    "Health": ["Health", "Healthcare", "Community Health", "Mental Health"],
    "Health & Human Services": ["Health & Human Services"],
    "Health & Legal Services": ["Health & Legal Services"],
    "Housing": ["Housing", "Housing & Community Development", "Housing and Community Development"],
    "Advocacy & Policy": ["Advocacy", "Public Policy & Advocacy", "Environmental Justice"],
    "Arts & Culture": ["Arts", "Arts & Culture"],
    "Community Development": ["Community", "Economic Development", "Economic & Community Development", "Family Support", "Leadership"],
    "Workforce Development": ["Workforce Development", "Workforce & Economic Development"],
    "Environment": ["Environment", "Environment & Conservation"],
    "Faith-Based": ["Faith-Based", "Faith Based"],
    "Philanthropy": ["Philanthropy", "Philanthropy & Capacity Building"],
    "Consulting & Research": ["Consulting", "Nonprofit Consulting", "Research and Evaluation", "Research/Technology"],
    "Government": ["Government"],
    "Social Services": ["Human Services", "Social Services", "Community Recreation"],
    "Veterans": ["Veteran Services"]
  };

  function getSimplifiedField(rawValue) {
    const val = (rawValue || "").trim();
    for (const [clean, rawList] of Object.entries(fieldMapping)) {
      if (rawList.includes(val)) return clean;
    }
    return "Other";
  }

  fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vTYnpuoLkjxdiZlB218BEqdIZI-q2kHXyc7_Jp73mhMan9Usx8i0Q5lMjR79fWzm9Aogaz1NDgDhtFM/pub?gid=1555558299&single=true&output=csv")
    .then(res => res.text())
    .then(csv => {
      const parsed = Papa.parse(csv, { header: true, skipEmptyLines: true });
      const data = parsed.data;

      // ISSUE AREA
      const fieldCounts = {};
      const orgCounts = {};

      data.forEach(row => {
        const field = getSimplifiedField(row["Field of NSA Host Organization"]);
        fieldCounts[field] = (fieldCounts[field] || 0) + 1;

        const org = row["Organization"];
        if (org) orgCounts[org] = (orgCounts[org] || 0) + 1;
      });

      const fieldLabels = Object.keys(fieldCounts);
      const fieldValues = Object.values(fieldCounts);
      const fieldColors = fieldLabels.map(() => '#' + Math.floor(Math.random() * 16777215).toString(16));

      new Chart(document.getElementById("fieldChart"), {
        type: "pie",
        data: {
          labels: fieldLabels,
          datasets: [{
            data: fieldValues,
            backgroundColor: fieldColors
          }]
        },
        options: {
          plugins: {
            legend: { position: "right" }
          }
        }
      });

      // TOP ORGS
      const sortedOrgs = Object.entries(orgCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
      new Chart(document.getElementById("orgChart"), {
        type: "bar",
        data: {
          labels: sortedOrgs.map(o => o[0]),
          datasets: [{
            label: "# of Alumni",
            data: sortedOrgs.map(o => o[1]),
            backgroundColor: "#3CBAC8"
          }]
        },
        options: {
          indexAxis: 'y',
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { beginAtZero: true }
          }
        }
      });

      // GENDER
      new Chart(document.getElementById("genderChart"), {
        type: "doughnut",
        data: {
          labels: ["Women", "Men", "Non-binary"],
          datasets: [{
            data: [65, 25, 10],
            backgroundColor: ["#3CBAC8", "#14455C", "#AAC3A5"]
          }]
        },
        options: {
          plugins: {
            legend: { position: "right" }
          }
        }
      });

      // RACE/ETHNICITY
      new Chart(document.getElementById("raceChart"), {
        type: "doughnut",
        data: {
          labels: ["Multi-racial", "Black or African-American", "Asian", "White / European Descent"],
          datasets: [{
            data: [33, 33, 14, 20],
            backgroundColor: ["#14455C", "#3CBAC8", "#AAC3A5", "#E0E0E0"]
          }]
        },
        options: {
          plugins: {
            legend: { position: "right" }
          }
        }
      });
    });
</script>

</body>
</html>
